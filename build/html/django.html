

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HTTP协议 &mdash; BLSNT BLOG 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="第一章 如何成为有钱人" href="host.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BLSNT BLOG
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="host.html">第一章 如何成为有钱人</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HTTP协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="#pythonweb">python三大主流web框架</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#django">Django安装注意事项</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id1">Django基础必备三件套</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id2">Django静态文件配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id3">Django连接数据库</a></li>
<li class="toctree-l1"><a class="reference internal" href="#django-orm">Django ORM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#orm">ORM 查询操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">模型表字段的增删改查</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">数据的增删改查</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#django-url">Django URL路由系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id6">路由基本使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">反向解析</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">伪静态</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id9">虚拟环境</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#url">简单实用无名分组来获取URL中的动态参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">简单实用有名分组来获取URL中的动态参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">路由分发</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">反向解析</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id14">伪静态</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id16">虚拟环境</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id18">Django版本区别</a></li>
<li class="toctree-l1"><a class="reference internal" href="#jsonresponse">JsonResponse</a></li>
<li class="toctree-l1"><a class="reference internal" href="#django-views">Django Views（视图函数）</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#request"><strong>request属性</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#httpresponse">HttpResponse对象</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id19">Django 模板语法</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id20"><strong>模板语法之变量</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id21">模板传值</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">模板之过滤器</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id23">模板之标签</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">模版继承</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id25">Django 模型层</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id26">图书管理系统表设计</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BLSNT BLOG</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>HTTP协议</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/django.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#http" id="id27">HTTP协议</a></p></li>
<li><p><a class="reference internal" href="#pythonweb" id="id28">python三大主流web框架</a></p>
<ul>
<li><p><a class="reference internal" href="#django" id="id29">Django安装注意事项</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id1" id="id30">Django基础必备三件套</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id31">Django静态文件配置</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id32">Django连接数据库</a></p></li>
<li><p><a class="reference internal" href="#django-orm" id="id33">Django ORM</a></p>
<ul>
<li><p><a class="reference internal" href="#orm" id="id34">ORM 查询操作</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id35">模型表字段的增删改查</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id36">数据的增删改查</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#django-url" id="id37">Django URL路由系统</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id38">路由基本使用</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id39">反向解析</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id40">伪静态</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id9" id="id41">虚拟环境</a></p>
<ul>
<li><p><a class="reference internal" href="#url" id="id42">简单实用无名分组来获取URL中的动态参数</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id43">简单实用有名分组来获取URL中的动态参数</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id44">路由分发</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id45">反向解析</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id14" id="id46">伪静态</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id47">虚拟环境</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id48">Django版本区别</a></p></li>
<li><p><a class="reference internal" href="#jsonresponse" id="id49">JsonResponse</a></p></li>
<li><p><a class="reference internal" href="#django-views" id="id50">Django Views（视图函数）</a></p>
<ul>
<li><p><a class="reference internal" href="#request" id="id51"><strong>request属性</strong></a></p></li>
<li><p><a class="reference internal" href="#httpresponse" id="id52">HttpResponse对象</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id19" id="id53">Django 模板语法</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id54"><strong>模板语法之变量</strong></a></p>
<ul>
<li><p><a class="reference internal" href="#id21" id="id55">模板传值</a></p></li>
<li><p><a class="reference internal" href="#id22" id="id56">模板之过滤器</a></p></li>
<li><p><a class="reference internal" href="#id23" id="id57">模板之标签</a></p></li>
<li><p><a class="reference internal" href="#id24" id="id58">模版继承</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id25" id="id59">Django 模型层</a></p></li>
<li><p><a class="reference internal" href="#id26" id="id60">图书管理系统表设计</a></p></li>
</ul>
</div>
<p>[TOC]</p>
<div class="section" id="http">
<h1><a class="toc-backref" href="#id27">HTTP协议</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>超文本传输协议</p></li>
<li><p>四大特性</p>
<ul>
<li><p>基于TCP/IP之上作用于应用层的协议</p></li>
<li><p>基于请求响应</p></li>
<li><p>无状态</p>
<ul>
<li><p>cookie</p></li>
<li><p>session</p></li>
<li><p>token</p></li>
</ul>
</li>
<li><p>无连接</p>
<ul>
<li><p>websocket</p></li>
</ul>
</li>
</ul>
</li>
<li><p>HTTP数据格式</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">http数据格式</span>
    <span class="n">请求格式</span>
        <span class="n">请求首行</span> <span class="n">GET</span> <span class="o">/</span><span class="n">index</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
        <span class="n">请求头</span><span class="p">(</span><span class="n">一大堆k</span><span class="p">,</span><span class="n">v键值对</span><span class="p">)</span>

        <span class="n">请求体</span><span class="p">(</span><span class="n">数据</span><span class="p">)</span>


    <span class="n">响应格式</span>
        <span class="n">响应首行</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
        <span class="n">响应头</span><span class="p">(</span><span class="n">一大堆k</span><span class="p">,</span><span class="n">v键值对</span><span class="p">)</span>

        <span class="n">响应体</span><span class="p">(</span><span class="n">数据</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>HTTP响应状态码</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="n">X</span><span class="p">:</span><span class="n">服务端已经接受到你的数据了</span> <span class="n">你可以继续提交数据进行下一步操作</span>
<span class="mi">20</span><span class="n">X</span><span class="p">:</span><span class="n">请求成功</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="mi">30</span><span class="n">X</span><span class="p">:</span><span class="n">重定向</span><span class="p">(</span><span class="mi">301</span><span class="p">,</span><span class="mi">302</span><span class="p">)</span>
<span class="mi">40</span><span class="n">X</span><span class="p">:</span><span class="n">请求错误</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="mi">50</span><span class="n">X</span><span class="p">:</span><span class="n">服务端错误</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pythonweb">
<h1><a class="toc-backref" href="#id28">python三大主流web框架</a><a class="headerlink" href="#pythonweb" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">a</span><span class="p">:</span><span class="n">socket服务</span>
 <span class="n">b</span><span class="p">:</span><span class="n">路由与视图函数映射关系</span>
 <span class="n">c</span><span class="p">:</span><span class="n">模板渲染</span>

<span class="n">django</span><span class="p">:</span><span class="n">大而全</span> <span class="n">类似于航空母舰</span>
    <span class="n">a用的别人的</span> <span class="n">wsgiref</span>  <span class="n">上线之后会换成uwsgi</span>
    <span class="n">b自己写的</span>
    <span class="n">c自己写的</span>

<span class="n">flask</span><span class="p">:</span><span class="n">小而精</span>  <span class="n">类似于游骑兵</span>
    <span class="n">a用的别人的</span>  <span class="n">werkzeug</span>
    <span class="n">b自己写的</span>
    <span class="n">c用的别人</span> <span class="n">jinja2</span>

<span class="n">tornado</span><span class="p">:</span><span class="n">异步非阻塞</span>
    <span class="n">三者都是自己写的</span>
</pre></div>
</div>
<div class="section" id="django">
<h2><a class="toc-backref" href="#id29">Django安装注意事项</a><a class="headerlink" href="#django" title="Permalink to this headline">¶</a></h2>
<p><strong>注意事项</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="mf">1.</span><span class="n">计算机名称不能含有中文</span>
    <span class="mf">2.</span><span class="n">一个pycharm窗口就是一个工程</span><span class="p">(</span><span class="n">项目</span><span class="p">)</span>
    <span class="mf">3.</span><span class="n">项目文件夹不要有中文</span>
<span class="n">ps</span><span class="p">:</span><span class="n">django版本问题</span>
    <span class="n">django</span> <span class="mf">1.</span><span class="n">X</span>
    <span class="n">django</span> <span class="mf">2.</span><span class="n">X</span>
</pre></div>
</div>
<p><strong>安装</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">django</span><span class="o">==</span><span class="mf">1.11</span><span class="o">.</span><span class="mi">11</span>
</pre></div>
</div>
<p><strong>命令行创建项目</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startproject</span> <span class="n">项目名</span>
</pre></div>
</div>
<p>ps:创建一个应用名的文件夹
里面有一个跟应用名同名的文件夹和一个manage.py文件</p>
<p><strong>创建应用</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startapp</span> <span class="n">应用名</span>
</pre></div>
</div>
<p><strong>启动django项目</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>
</pre></div>
</div>
<p>注意：</p>
<p>命令创建django项目不会自动创建templates文件夹</p>
<p>settings配置文件中要添加templates的路径</p>
<p><img alt="image0" src="http://images.dregs.top/images/20190923235329.png" /></p>
<p>浏览器访问：127.0.0.1:8000</p>
<p>注意:
1.在django中创建的应用必须去settings文件中注册才能生效否则django不识别</p>
<p><img alt="image1" src="http://images.dregs.top/images/20190923235733.png" /></p>
<p>2 确保不要端口冲突</p>
<p><strong>django配置文件</strong></p>
<p><img alt="image2" src="http://images.dregs.top/images/20190924000255.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">项目名</span>
    <span class="n">应用名文件夹</span>
        <span class="n">migrations文件夹</span>
            <span class="n">数据库迁移记录</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">py</span>
            <span class="n">django</span> <span class="n">admin后台管理相关</span>
        <span class="n">models</span><span class="o">.</span><span class="n">py</span>
            <span class="n">模型类</span>
        <span class="n">views</span><span class="o">.</span><span class="n">py</span>
            <span class="n">视图函数</span>

    <span class="n">项目同名文件夹</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">py</span>
            <span class="n">django暴露用户可配置的配置文件</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">py</span>
            <span class="n">路由与视图函数映射关系</span>
    <span class="n">templates</span>
        <span class="n">所有的html文件</span>
    <span class="n">manage</span><span class="o">.</span><span class="n">py</span>
        <span class="n">django入口文件</span>
</pre></div>
</div>
<p><strong>刚开始学习时可在配置文件中暂时禁用csrf中间件，方便表单提交测试。</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id30">Django基础必备三件套</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
</pre></div>
</div>
<p>定义一个index,编辑urls.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^index/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>

<span class="p">]</span>
</pre></div>
</div>
<p>编辑views.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span><span class="n">HttpResponse</span><span class="p">,</span><span class="n">redirect</span>

<span class="c1"># Create your views here.</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello django index&#39;</span><span class="p">)</span>  <span class="c1"># 返回字符串</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;login.html&#39;</span><span class="p">)</span>        <span class="c1"># 返回html页面</span>

<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;https://www.baidu.com&#39;</span><span class="p">)</span>   <span class="c1"># 重定向</span>
</pre></div>
</div>
<p>浏览器访问</p>
<p><img alt="image3" src="http://images.dregs.top/images/20190924001132.png" /></p>
</div>
<div class="section" id="id2">
<h1><a class="toc-backref" href="#id31">Django静态文件配置</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h1>
<p>网站所用到的已经写好的文件(css,js,图片)</p>
<p><img alt="image4" src="http://images.dregs.top/images/20190924182422.png" /></p>
<p>settings.py文件配置静态文件放置目录,添加到文件最下面</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;/static/&#39;</span>   <span class="c1">#这是接口前缀，html里面的静态文件前缀都要是static</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>动态监测接口前缀变化同步到html</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">static</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{</span><span class="si">% s</span><span class="s2">tatic &#39;bootstrap-3.3.7/css/bootstrap.min.css&#39;%}&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="p">{</span><span class="o">%</span> <span class="n">static</span> <span class="s2">&quot;bootstrap-3.3.7/js/bootstrap.min.js&quot;</span><span class="o">%</span><span class="p">}</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>form表单默认是get请求</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>get请求携带的参数是拼接在url后面的以?开头&amp;链接
ps:get请求可以携带参数 但是参数的大小有限制 最大4KB，并且是明文的
http://127.0.0.1:8000/login/?username=jason&amp;password=123
</pre></div>
</div>
<p>action参数有三种写法</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">什么都不写</span> <span class="n">默认往当前页面的url地址提交</span>
<span class="mf">2.</span><span class="n">只写路由后缀</span><span class="p">(</span><span class="o">******</span><span class="p">)</span>
<span class="mf">3.</span><span class="n">写全路径</span>
</pre></div>
</div>
<p>登录功能</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 读取post请求提交的数据</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>  <span class="c1"># 虽然值是一个列表，但是get方法只会获取到列表最后一个元素</span>
        <span class="c1"># hobby = request.POST.getlist(&#39;xxx&#39;)    # 如果想要获取到列表中到多个值，用getlist方法</span>

        <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;blsnt&#39;</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">&#39;123&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;http://www.xiaohuar.com&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;没钱滚&#39;</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>获取用户输入的框 都必须要有name属性</p>
</div></blockquote>
</div>
<div class="section" id="id3">
<h1><a class="toc-backref" href="#id32">Django连接数据库</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p>1.settings.py配置字段</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CHARSET&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>2.去应用名下的__init__.py或者项目名下的__init__.py文件中
告诉django不要使用默认的mysqld_db模块连接mysql而是使用pymysql</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></div>
</div>
<p>2.mysql-connector-python</p>
<p>　　这是mysql的官方的驱动包，对于mysql 不同版本的加密方式，不受影响。</p>
<p>　　A. 安装包: pip install mysql-connector-python</p>
<p>　　B. 修改Django 项目中的setting文件中的 ENGINE 的配置：</p>
<p><img alt="image5" src="http://images.dregs.top/images/20191223112014.png" /></p>
<p>　　C. 然后生成迁移文件，并执行迁移程序。</p>
<p>　　　　python manage.py makemigrations</p>
<p>　　　　python mangage.py migrate</p>
</div>
<div class="section" id="django-orm">
<h1><a class="toc-backref" href="#id33">Django ORM</a><a class="headerlink" href="#django-orm" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">对象关系映射</span>

<span class="n">类</span>            <span class="o">&gt;&gt;&gt;</span>                <span class="n">数据库的表</span>

<span class="n">对象</span>           <span class="o">&gt;&gt;&gt;</span>                <span class="n">数据库里面的一条条的表记录</span>

<span class="n">对象点属性</span>      <span class="o">&gt;&gt;&gt;</span>              <span class="n">表记录的某个字段对应的值</span>
</pre></div>
</div>
<blockquote>
<div><p>能够让一个不会数据库操作的人
也能够通过编程语言轻松的操作数据库,有时候sql语句的查询效率可能偏低</p>
</div></blockquote>
<p>注意事项：</p>
<p>1.models.py中写模型类</p>
<p>2.执行数据库同步命令</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>   <span class="c1">#将数据的更改操作记录到小本本上</span>
<span class="n">python3</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>          <span class="c1">#将更改真正同步到数据库</span>
</pre></div>
</div>
<blockquote>
<div><p>不能创建库，只能创建表</p>
</div></blockquote>
<div class="section" id="orm">
<h2><a class="toc-backref" href="#id34">ORM 查询操作</a><a class="headerlink" href="#orm" title="Permalink to this headline">¶</a></h2>
<p>views.py将前端传入的用户名和密码拿出来做if判断数据库是否有这个用户</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="n">app01</span> <span class="kn">import</span> <span class="nn">models</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>  <span class="c1"># 获取当前请求方式</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># user_obj = models.User.objects.filter(username=username)</span>
        <span class="c1"># print(user_obj.query) # 获取sql语句</span>

        <span class="c1"># user_obj = models.User.objects.filter(username=username)[0]  # 支持正向索引,不推荐</span>

        <span class="c1"># user_obj = models.User.objects.filter(username=username)[-1] # 不支持负数索引</span>

        <span class="c1"># user_obj = models.User.objects.filter(username=username).first()  # 推荐使用first获取对象</span>

        <span class="n">is_alive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>  <span class="c1"># filter支持传多个参数 并且是and的关系</span>
        <span class="k">if</span> <span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;登录成功&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;登录失败&#39;</span><span class="p">)</span>
        <span class="c1"># select id,username,password from user where username=&#39;jason&#39; and password = &#39;123&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        filter方法</span>
<span class="sd">        当条件存在的时候 &lt;QuerySet [&lt;User: User object&gt;]&gt;        jQuery对象与原生js对象之间的关系</span>
<span class="sd">        条件不存再 &lt;QuerySet []&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(user_obj)</span>
        <span class="c1"># print(user_obj.id)</span>
        <span class="c1"># print(user_obj.pk)  # pk会自动查找当前对象的主键字段</span>
        <span class="c1"># print(user_obj.username)</span>
        <span class="c1"># print(user_obj.password)</span>
        <span class="c1"># print(hobby,type(hobby))</span>
        <span class="c1"># print(username,type(username))</span>
        <span class="c1"># print(password,type(password))</span>


    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;login.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id35">模型表字段的增删改查</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>models.py跟数据库相关的操作都在这个文件里面</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 只要修改了models.py中跟数据库相关的数据，必须重新执行数据库的两条迁移命令</span>
    <span class="c1"># email = models.EmailField(null=True)            # 要删除这个数据，直接#然后再执行两条数据库迁移命令即可</span>
</pre></div>
</div>
<blockquote>
<div><p>python3 manage.py makemigrations 将数据的更改操作记录到小本本上</p>
<p>python3 manage.py migrate 将更改真正同步到数据库</p>
</div></blockquote>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id36">数据的增删改查</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr&#39;</span><span class="p">)</span>

        <span class="c1"># orm创建数据</span>
        <span class="c1"># 第一种</span>
        <span class="c1"># models.User.objects.create(username=username,password=password,addr=addr)</span>

        <span class="c1"># 第二种</span>
        <span class="n">user_obj</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
        <span class="n">user_obj</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">user_obj</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="n">user_obj</span><span class="o">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">addr</span>
        <span class="n">user_obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c1"># 保存到数据库</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/user_list&#39;</span><span class="p">)</span>   <span class="c1"># 注册完数据跳转到展示页面</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;register.html&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">user_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 获取表所有到数据</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># select id,username,password,addr from user</span>

    <span class="c1"># return render(request,&#39;list_html&#39;,{&#39;data&#39;:data}) # 第一种给页面传值的方式</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;list_html&#39;</span><span class="p">,</span><span class="nb">locals</span><span class="p">())</span> <span class="c1"># 会将当前名称空间中的所有的名字都传递给前端</span>
</pre></div>
</div>
<p>编辑数据</p>
<p><img alt="image6" src="http://images.dregs.top/images/20191022024543.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">edit_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr&#39;</span><span class="p">)</span>
        <span class="c1"># queryset对象 可以直接调用update方法进行批量更新  如果queryset对象中有多个数据对象 那么会将多个数据对象全部更新</span>
        <span class="c1"># 第一种更新方式</span>
        <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">edit_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span><span class="n">addr</span><span class="o">=</span><span class="n">addr</span><span class="p">)</span>
        <span class="c1"># 第二种更新方式</span>
        <span class="c1"># edit_obj = models.User.objects.filter(pk=edit_id).first()</span>
        <span class="c1"># edit_obj.username = username</span>
        <span class="c1"># edit_obj.password = password</span>
        <span class="c1"># edit_obj.addr = addr</span>
        <span class="c1"># edit_obj.save()  # 不推荐使用  它是从头到尾重新写一遍</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/user_list&#39;</span><span class="p">)</span>
    <span class="c1"># print(request.GET)  # 获取get请求携带参数</span>
    <span class="n">edit_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="c1"># 查询该主键对应的数据对象</span>
    <span class="n">edit_obj</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">edit_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;edit.html&#39;</span><span class="p">,</span><span class="nb">locals</span><span class="p">())</span>
</pre></div>
</div>
<p>删除数据</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">delete_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">delete_id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>  <span class="c1"># 批量删除</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/user_list&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="django-url">
<h1><a class="toc-backref" href="#id37">Django URL路由系统</a><a class="headerlink" href="#django-url" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id38">路由基本使用</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^test/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;testadd/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">testadd</span><span class="p">),</span>
<span class="p">]</span>
<span class="c1"># url的第一个参数 其实是一个正则表达式</span>
<span class="c1"># 获取用户输入的url 然后根据正则匹配 是否对应</span>
<span class="c1"># urls中只要匹配到了 就会立刻执行对应的函数 不会在往下继续匹配</span>
<span class="c1"># 第一次如果都没有匹配上的话 会自动加/再次匹配 如果还匹配不上直接报错</span>
</pre></div>
</div>
<p>无名分组</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># 无名分组，会将分组内到结果，当作位置参数自动传递给后面的视图函数</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^test/([0-9]</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>有名分组</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># 无名分组，会将分组内到结果，当作关键字参数自动传递给后面的视图函数</span>
        <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^test/(?p&lt;id&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id39">反向解析</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>根据别名动态解析出可以匹配上视图函数</p>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id40">伪静态</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>让一个动态页面伪装成一个看似已经写死了的页面</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^register.html&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h1><a class="toc-backref" href="#id41">虚拟环境</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h1>
<p>针对不同的项目，只下载对应项目的模块</p>
<p><img alt="image7" src="http://images.dregs.top/images/20191023014412.png" /></p>
<div class="section" id="url">
<h2><a class="toc-backref" href="#id42">简单实用无名分组来获取URL中的动态参数</a><a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h2>
<p>URL配置(URLconf)就像Django
所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表；你就是以这种方式告诉Django，对于这个URL调用这段代码，对于那个URL调用那段代码。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>urlpatterns = [
    url(正则表达式, views视图函数，参数，别名),
]
</pre></div>
</div>
<p>参数说明：</p>
<ul class="simple">
<li><p>一个正则表达式字符串</p></li>
<li><p>一个可调用对象，通常为一个视图函数或一个指定视图函数路径的字符串</p></li>
<li><p>可选的要传递给视图函数的默认参数（字典形式）</p></li>
<li><p>一个可选的name参数</p></li>
</ul>
<p>urls.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^index/2003/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>           <span class="c1">#一定要注意路径是否会被前面到捕捉到</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/([0-9]</span><span class="si">{4}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span> <span class="c1">#year_archive(request,2006)</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/([0-9]</span><span class="si">{4}</span><span class="s1">)/([0-9]</span><span class="si">{2}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">month_archive</span><span class="p">),</span> <span class="c1">#year_archive(request,2006,12)</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/([0-9]</span><span class="si">{4}</span><span class="s1">)/([0-9]</span><span class="si">{2}</span><span class="s1">)/([0-9]+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">article_detail</span><span class="p">),</span> <span class="c1">#year_archive(request,2006,12,99)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>views.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span><span class="n">HttpResponse</span><span class="p">,</span><span class="n">redirect</span>

<span class="c1"># Create your views here.</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello django index&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">year_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">month_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;year:</span><span class="si">%s</span><span class="s1"> month:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">article_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">article</span><span class="p">):</span>
    <span class="k">return</span>  <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;year:</span><span class="si">%s</span><span class="s1"> month:</span><span class="si">%s</span><span class="s1"> article:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">article</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id43">简单实用有名分组来获取URL中的动态参数</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>urls.py 会把分组内的结果，当做位置参数自动传递给后面的视图函数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/2003/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">special_case_2003</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/(?P&lt;month&gt;[0-9]</span><span class="si">{2}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">month_archive</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/(?P&lt;month&gt;[0-9]</span><span class="si">{2}</span><span class="s1">)/(?P&lt;day&gt;[0-9]</span><span class="si">{2}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">article_detail</span><span class="p">),</span>
<span class="p">]</span>
 <span class="c1">#通过?p&lt;&gt;给分组起名字，传参到views里面，跟关键字传参一样</span>
</pre></div>
</div>
<p>views.py 参数名字要跟urls分组里面的名字一样</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span><span class="n">HttpResponse</span><span class="p">,</span><span class="n">redirect</span>

<span class="c1"># Create your views here.</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello django index&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">year_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">month_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;year:</span><span class="si">%s</span><span class="s1"> month:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">article_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">article</span><span class="p">):</span> <span class="c1">#不管参数位置怎么变，参数还是对应的，不会走位置</span>
    <span class="k">return</span>  <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;year:</span><span class="si">%s</span><span class="s1"> month:</span><span class="si">%s</span><span class="s1"> article:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">article</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id44">路由分发</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#At any point, your urlpatterns can “include” other URLconf modules. This</span>
<span class="c1">#essentially “roots” a set of URLs below other ones.</span>

<span class="c1">#For example, here’s an excerpt of the URLconf for the Django website itself.</span>
<span class="c1">#It includes a number of other URLconfs:</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
   <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
   <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;blog.urls&#39;</span><span class="p">)),</span> <span class="c1">#以blog开头的分发到blog里面的urls</span>
<span class="p">]</span>
<span class="c1">#要先创建这个应用，然后include这个应用的路由</span>
<span class="c1"># ^?匹配根目录</span>
</pre></div>
</div>
<p>小结：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    NOTE:
    1 一旦匹配成功则不再继续
    2 若要从URL 中捕获一个值，只需要在它周围放置一对圆括号。
    3 不需要添加一个前导的反斜杠，因为每个URL 都有。例如，应该是^articles 而不是 ^/articles。
    4 每个正则表达式前面的&#39;r&#39; 是可选的但是建议加上。

一些请求的例子：

    /articles/2005/3/ 不匹配任何URL 模式，因为列表中的第三个模式要求月份应该是两个数字。
    /articles/2003/ 将匹配列表中的第一个模式不是第二个，因为模式按顺序匹配，第一个会首先测试是否匹配。
    /articles/2005/03/ 请求将匹配列表中的第三个模式。Django 将调用函数
                       views.month_archive(request, &#39;2005&#39;, &#39;03&#39;)。
#设置项是否开启URL访问地址后面不为/跳转至带有/的路径
APPEND_SLASH=True
</pre></div>
</div>
</div>
<div class="section" id="id12">
<span id="id13"></span><h2><a class="toc-backref" href="#id45">反向解析</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">反向解析</span>
    <span class="n">注意</span><span class="p">:</span><span class="n">在起别名的时候</span> <span class="n">一定要保证</span> <span class="n">所有的别名都不能重复</span>  <span class="n">必须是唯一的</span>

    <span class="n">根据别名动态解析出可以匹配上视图函数之前的url的一个结果</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^testxxx/&#39;</span><span class="p">,</span><span class="n">views</span><span class="o">.</span><span class="n">test</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^test/(\d+)/$&#39;</span><span class="p">,</span><span class="n">views</span><span class="o">.</span><span class="n">test</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ttt&#39;</span><span class="p">),</span>
    <span class="n">前端</span>
        <span class="n">没有正则表达式的反向解析</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">url</span> <span class="s1">&#39;t&#39;</span> <span class="o">%</span><span class="p">}</span>
        <span class="n">无名分组反向解析</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">url</span> <span class="s1">&#39;ttt&#39;</span> <span class="mi">1</span> <span class="o">%</span><span class="p">}</span>
        <span class="n">有名分组同上</span>

    <span class="n">后端</span>
        <span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span><span class="n">HttpResponse</span><span class="p">,</span><span class="n">redirect</span><span class="p">,</span><span class="n">reverse</span>
        <span class="n">没有正则表达式的反向解析</span>
        <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">无名分组反向解析</span>
        <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;ttt&#39;</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">有名分组同上</span>


    <span class="n">ps</span><span class="p">:</span><span class="n">数字通常是数据库中查出来的数据的主键值</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id14">
<span id="id15"></span><h1><a class="toc-backref" href="#id46">伪静态</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">让一个动态页面伪装成一个看似数据已经写死了的静态页面</span>
<span class="n">让搜索引擎加大对你这个页面的搜藏力度</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<span id="id17"></span><h1><a class="toc-backref" href="#id47">虚拟环境</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">虚拟环境就类似于你又下载了一个python解释器</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h1><a class="toc-backref" href="#id48">Django版本区别</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>1.x 路由里面用的是url()
2.x 路由里面用的是path(),url第一个参数放的是正则表达式，而path第一个参数写什么就是什么，不支持郑泽如果你还想用正则，django2.x版本中有一个re_path(),等价于1.x中的url
</pre></div>
</div>
</div>
<div class="section" id="jsonresponse">
<h1><a class="toc-backref" href="#id49">JsonResponse</a><a class="headerlink" href="#jsonresponse" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;json&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="s1">&#39;123&#39;</span><span class="p">,</span><span class="s1">&#39;hobby&#39;</span><span class="p">:</span><span class="s1">&#39;读书&#39;</span><span class="p">}</span>
    <span class="c1"># 方式一:</span>
    <span class="c1"># return HttpResponse(json.dumps(d))</span>
    <span class="c1"># 方式二:</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">json_dumps_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ensure_ascii&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span> <span class="c1"># 返回给前端就能显示中文读书</span>
</pre></div>
</div>
<p>注意：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="s1">&#39;hobby&#39;</span><span class="p">:</span> <span class="s1">&#39;读书&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>  <span class="c1"># 原样输出中文读书</span>
</pre></div>
</div>
</div>
<div class="section" id="django-views">
<h1><a class="toc-backref" href="#id50">Django Views（视图函数）</a><a class="headerlink" href="#django-views" title="Permalink to this headline">¶</a></h1>
<p>一个视图函数，简称视图，是一个简单的Python
函数，它接受Web请求并且返回Web响应。响应可以是一张网页的HTML内容，一个重定向，一个404错误，一个XML文档，或者一张图片.
. .
是任何东西都可以。无论视图本身包含什么逻辑，都要返回响应。代码写在哪里也无所谓，只要它在你的Python目录下面。除此之外没有更多的要求了——可以说“没有什么神奇的地方”。为了将代码放在某处，约定是将视图放置在项目或应用程序目录中的名为<code class="docutils literal notranslate"><span class="pre">views.py</span></code>的文件中。</p>
<div class="section" id="request">
<h2><a class="toc-backref" href="#id51"><strong>request属性</strong></a><a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="c1">#请求方式</span>
<span class="n">request</span><span class="o">.</span><span class="n">path</span>   <span class="c1">#请求路径</span>
<span class="n">request</span><span class="o">.</span><span class="n">POST</span>   <span class="c1">#POST的请求数据 字典格式</span>
<span class="n">request</span><span class="o">.</span><span class="n">GET</span>    <span class="c1">#GET的请求数据 字典格式</span>
<span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span>  <span class="c1">#请求头</span>
<span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">()</span>  <span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="httpresponse">
<h2><a class="toc-backref" href="#id52">HttpResponse对象</a><a class="headerlink" href="#httpresponse" title="Permalink to this headline">¶</a></h2>
<p>Django对于一定最后响应一个httpResponse的实例对象</p>
<p>三种形式：</p>
<ol class="arabic simple">
<li><p>httpResponse(‘字符串’)</p></li>
<li><p>render(‘页面’)</p></li>
<li><p>redirect(重定向)</p></li>
</ol>
<p>传递要重定向的一个硬编码的URL</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/some/url/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>也可以是一个完整的URL</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;http://example.com/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>两次请求</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>1）301和302的区别。
　　301和302状态码都表示重定向，就是说浏览器在拿到服务器返回的这个状态码后会自动跳转到一个新的URL地址，这个地址可以从响应的Location首部中获取
  （用户看到的效果就是他输入的地址A瞬间变成了另一个地址B）——这是它们的共同点。
　　他们的不同在于。301表示旧地址A的资源已经被永久地移除了（这个资源不可访问了），搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址；
　　302表示旧地址A的资源还在（仍然可以访问），这个重定向只是临时地从旧地址A跳转到地址B，搜索引擎会抓取新的内容而保存旧的网址。 SEO302好于301


2）重定向原因：
（1）网站调整（如改变网页目录结构）；
（2）网页被移到一个新地址；
（3）网页扩展名改变(如应用需要把.php改成.Html或.shtml)。
        这种情况下，如果不做重定向，则用户收藏夹或搜索引擎数据库中旧地址只能让访问客户得到一个404页面错误信息，访问流量白白丧失；再者某些注册了多个域名的
    网站，也需要通过重定向让访问这些域名的用户自动跳转到主站点等。
</pre></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h1><a class="toc-backref" href="#id53">Django 模板语法</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="id20">
<h1><a class="toc-backref" href="#id54"><strong>模板语法之变量</strong></a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="n">s</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span>
    <span class="n">l</span><span class="o">=</span><span class="p">[</span><span class="mi">111</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">333</span><span class="p">]</span>    <span class="c1"># 列表</span>
    <span class="n">dic</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;yuan&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">18</span><span class="p">}</span>  <span class="c1"># 字典</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1"># 日期对象</span>

    <span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>

    <span class="n">person_yuan</span><span class="o">=</span><span class="n">Person</span><span class="p">(</span><span class="s2">&quot;yuan&quot;</span><span class="p">)</span>  <span class="c1"># 自定义类对象</span>
    <span class="n">person_egon</span><span class="o">=</span><span class="n">Person</span><span class="p">(</span><span class="s2">&quot;egon&quot;</span><span class="p">)</span>
    <span class="n">person_alex</span><span class="o">=</span><span class="n">Person</span><span class="p">(</span><span class="s2">&quot;alex&quot;</span><span class="p">)</span>

    <span class="n">person_list</span><span class="o">=</span><span class="p">[</span><span class="n">person_yuan</span><span class="p">,</span><span class="n">person_egon</span><span class="p">,</span><span class="n">person_alex</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s2">&quot;index.html&quot;</span><span class="p">,{</span><span class="s2">&quot;l&quot;</span><span class="p">:</span><span class="n">l</span><span class="p">,</span><span class="s2">&quot;dic&quot;</span><span class="p">:</span><span class="n">dic</span><span class="p">,</span><span class="s2">&quot;date&quot;</span><span class="p">:</span><span class="n">date</span><span class="p">,</span><span class="s2">&quot;person_list&quot;</span><span class="p">:</span><span class="n">person_list</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>template：</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">s</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">列表</span><span class="p">:{{</span> <span class="n">l</span><span class="o">.</span><span class="mi">0</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">列表</span><span class="p">:{{</span> <span class="n">l</span><span class="o">.</span><span class="mi">2</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">字典</span><span class="p">:{{</span> <span class="n">dic</span><span class="o">.</span><span class="n">name</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">日期</span><span class="p">:{{</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">类对象列表</span><span class="p">:{{</span> <span class="n">person_list</span><span class="o">.</span><span class="mf">0.</span><span class="n">name</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>注意：句点符也可以用来引用对象的方法(无参数方法):</p>
<div class="section" id="id21">
<h2><a class="toc-backref" href="#id55">模板传值</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">第一种</span>
   <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;demo.html&#39;</span><span class="p">,{</span><span class="s1">&#39;xxx&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]})</span>

<span class="n">第二种</span>
   <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;demo.html&#39;</span><span class="p">,</span><span class="nb">locals</span><span class="p">())</span>

<span class="c1"># 如果是函数名，传递到前端，会自动加括号执行，将结果传递到前端</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h2><a class="toc-backref" href="#id56">模板之过滤器</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>语法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="n">obj</span><span class="o">|</span><span class="n">filter__name</span><span class="p">:</span><span class="n">parm</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>default</strong></p>
<p>如果是一个变量是false或者为空，使用给定的默认值，否则，使用变量的值</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">default</span><span class="p">:</span><span class="s2">&quot;nothing&quot;</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>Length</strong></p>
<p>返回值的长度，它对字符串呵列表都起作用</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">length</span> <span class="p">}}</span>
</pre></div>
</div>
<p>如果 value 是 [‘a’, ‘b’, ‘c’, ‘d’]，那么输出是 4。</p>
<p><strong>filesizeformat</strong></p>
<p>将值格式化为一个 “人类可读的” 文件尺寸 （例如 <code class="docutils literal notranslate"><span class="pre">'13</span> <span class="pre">KB'</span></code>, <code class="docutils literal notranslate"><span class="pre">'4.1</span> <span class="pre">MB'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'102</span> <span class="pre">bytes'</span></code>, 等等）。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">filesizeformat</span> <span class="p">}}</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">value</span></code> 是 123456789，输出将会是 <code class="docutils literal notranslate"><span class="pre">117.7</span> <span class="pre">MB</span></code>。</p>
<p><strong>date</strong></p>
<p>如果 value=datetime.datetime.now()</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">date</span><span class="p">:</span><span class="s2">&quot;Y-m-d&quot;</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>slice</strong></p>
<p>如果 value=“hello world”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="nb">slice</span><span class="p">:</span><span class="s2">&quot;2:-1&quot;</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>truncatechars</strong></p>
<p>如果字符串字符多于指定的字符数量，那么会被截断。截断的字符串将以可翻译的省略号序列（“…”）结尾。</p>
<p><strong>参数：</strong>要截断的字符数</p>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">truncatechars</span><span class="p">:</span><span class="mi">9</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>safe</strong></p>
<p>Django的模板中会对HTML标签和JS等语法标签进行自动转义，原因显而易见，这样是为了安全。但是有的时候我们可能不希望这些HTML元素被转义，比如我们做一个内容管理系统，后台添加的文章中是经过修饰的，这些修饰可能是通过一个类似于FCKeditor编辑加注了HTML修饰符的文本，如果自动转义的话显示的就是保护HTML标签的源文件。为了在Django中关闭HTML的自动转义有两种方式，如果是一个单独的变量我们可以通过过滤器“|safe”的方式告诉Django这段代码是安全的不必转义。比如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&lt;a href=&quot;&quot;&gt;点击&lt;/a&gt;&quot;</span>
<span class="p">{{</span> <span class="n">value</span><span class="o">|</span><span class="n">safe</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="id23">
<h2><a class="toc-backref" href="#id57">模板之标签</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>标签看起来像是这样的：
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">tag</span> <span class="pre">%}</span></code>。标签比变量更加复杂：一些在输出中创建文本，一些通过循环或逻辑来控制流程，一些加载其后的变量将使用到的额外信息到模版中。一些标签需要开始和结束标签
（例如<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">tag</span> <span class="pre">%}</span> <span class="pre">...</span></code>标签 内容 … {% endtag %}）。</p>
<p><strong>for标签</strong></p>
<p>遍历每一个元素</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">person_list</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">person</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>可以利用<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">obj</span> <span class="pre">in</span> <span class="pre">list</span> <span class="pre">reversed</span> <span class="pre">%}</span></code>反向完成循环。</p>
<p>遍历一个字典：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">key</span> <span class="p">}}:{{</span> <span class="n">val</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>注：循环序号可以通过｛｛forloop｝｝显示</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">forloop</span><span class="o">.</span><span class="n">counter</span>            <span class="n">The</span> <span class="n">current</span> <span class="n">iteration</span> <span class="n">of</span> <span class="n">the</span> <span class="n">loop</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">forloop</span><span class="o">.</span><span class="n">counter0</span>           <span class="n">The</span> <span class="n">current</span> <span class="n">iteration</span> <span class="n">of</span> <span class="n">the</span> <span class="n">loop</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">forloop</span><span class="o">.</span><span class="n">revcounter</span>         <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="n">loop</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">forloop</span><span class="o">.</span><span class="n">revcounter0</span>        <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="n">loop</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="n">indexed</span><span class="p">)</span>
<span class="n">forloop</span><span class="o">.</span><span class="n">first</span>              <span class="kc">True</span> <span class="k">if</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">time</span> <span class="n">through</span> <span class="n">the</span> <span class="n">loop</span>
<span class="n">forloop</span><span class="o">.</span><span class="n">last</span>               <span class="kc">True</span> <span class="k">if</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">last</span> <span class="n">time</span> <span class="n">through</span> <span class="n">the</span> <span class="n">loop</span>
</pre></div>
</div>
<p><strong>if  标签</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code>会对一个变量求值，如果它的值是“True”（存在、不为空、且不是boolean类型的false值），对应的内容块会输出。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">无效</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">优秀</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">凑活吧</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>with</strong></p>
<p>使用一个简单地名字缓存一个复杂的变量，当你需要使用一个“昂贵的”方法（比如访问数据库）很多次的时候是非常有用的</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">with</span> <span class="n">total</span><span class="o">=</span><span class="n">business</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">count</span> <span class="o">%</span><span class="p">}</span>
    <span class="p">{{</span> <span class="n">total</span> <span class="p">}}</span> <span class="n">employee</span><span class="p">{{</span> <span class="n">total</span><span class="o">|</span><span class="n">pluralize</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endwith</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>csrf_token</strong></p>
<p>这个标签用于跨站请求伪造保护,加到form表单即可</p>
</div>
<div class="section" id="id24">
<h2><a class="toc-backref" href="#id58">模版继承</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>Django模版引擎中最强大也是最复杂的部分就是模版继承了。模版继承可以让您创建一个基本的“骨架”模版，它包含您站点中的全部元素，并且可以定义能够被子模版覆盖的
blocks 。</p>
<p>通过从下面这个例子开始，可以容易的理解模版继承：</p>
</div>
</div>
<div class="section" id="id25">
<h1><a class="toc-backref" href="#id59">Django 模型层</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h1>
<p>单独测试django里面某个功能</p>
<p>将manage.py里面的四段拷贝到tests.py里面</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">django</span>
    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
<p>针对单表操作</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="c1"># Create your tests here.</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">django</span>
    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">models</span>

    <span class="c1"># 增加数据</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;三国演义&#39;</span><span class="p">,</span><span class="n">price</span><span class="o">=</span><span class="mf">123.23</span><span class="p">,</span><span class="n">publish_date</span><span class="o">=</span><span class="s1">&#39;2019-09-26&#39;</span><span class="p">)</span>

    <span class="c1"># 加入时间戳</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="n">ctime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;红楼梦&#39;</span><span class="p">,</span><span class="n">price</span><span class="o">=</span><span class="s1">&#39;1666.23&#39;</span><span class="p">,</span><span class="n">publish_date</span><span class="o">=</span><span class="n">ctime</span><span class="p">)</span>

    <span class="c1"># 修改</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;三国演义&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="mf">1123.23</span><span class="p">)</span>

    <span class="c1"># 查询</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 推荐使用</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># get获取到到就是数据对象本身，但是当条件不满足的时候，会直接报错，不推荐使用</span>

    <span class="c1"># 删除</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="c1"># 反向查找</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 取反</span>

    <span class="c1"># 只拿数据的某几个字段</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
        <span class="c1"># vales返回的是列表套字典</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
        <span class="c1"># vales_list返回的是列表套元祖</span>

    <span class="c1"># 对数据进行排序</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
        <span class="c1"># 默认是升序，从小到大</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="c1"># 反转，从大到小</span>

    <span class="c1"># 去重(前提是：数据必须一样)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;三国演义&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

    <span class="c1"># 统计</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="c1"># 如果QuerySet包含数据，就返回True，否则返回False</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

    <span class="c1"># 查询价格大于2000的</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gt</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

    <span class="c1"># 查询价格小于2000的</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__lt</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

    <span class="c1"># 查询价格大于等于2000的</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gte</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

    <span class="c1"># 查询价格小于等于2000的</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__lte</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

    <span class="c1"># 价格1000-2000之间的</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__range</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">])</span> <span class="c1"># 两边都包含</span>

    <span class="c1"># 查询主键在指定到条件内</span>
    <span class="n">models</span><span class="o">.</span><span class="n">BookList</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h1><a class="toc-backref" href="#id60">图书管理系统表设计</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h1>
<p>表关系</p>
<ul class="simple">
<li><p>一对一</p></li>
<li><p>一对多</p></li>
<li><p>多对多</p></li>
</ul>
<p>表关系判断：站在两边是否可以同时有多个对方，如果都可以，那么就是一个多对多，如果是单向的一对多，那就是一对多，如果都不是，要么没有任何关系，要么就是一对一</p>
<p>Book</p>
<p>Publish</p>
<p>Author</p>
<p>AuthorDetail</p>
<p>书和出版社就是一个一对多</p>
<p>书和作者就是一个多对多</p>
<p>作者和作者详情就是一个一对一</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="p">(</span><span class="s1">&#39;codeCheck&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;拉取代码&#39;</span><span class="p">){</span>
<span class="o">//</span>          <span class="n">git</span> <span class="n">credentialsId</span><span class="p">:</span> <span class="s1">&#39;1dc3c20c-b9c5-4294-93c4-9b0cdbd3cd78&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;git@coding.ypsx-internal.com:arch-foundation/ostrich/ostrich-api-gateway.git&#39;</span>
            <span class="n">git</span> <span class="n">credentialsId</span><span class="p">:</span> <span class="s1">&#39;1dc3c20c-b9c5-4294-93c4-9b0cdbd3cd78&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;git@coding.ypsx-internal.com:business-platform/ypsx-order.git&#39;</span>
         <span class="n">updateGitlabCommitStatus</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;拉取代码&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span>
    <span class="p">}</span>
    <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;质量扫描&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">withSonarQubeEnv</span><span class="p">(</span><span class="s1">&#39;Sonarqube&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">sh</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">             /usr/local/sonar-scanner/bin/sonar-scanner -X </span><span class="se">\</span>
<span class="s1">            -Dsonar.host.url=$</span><span class="si">{SONAR_HOST_URL}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">            -Dsonar.language=java </span><span class="se">\</span>
<span class="s1">            -Dsonar.projectKey=$</span><span class="si">{JOB_NAME}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">            -Dsonar.projectName=$</span><span class="si">{JOB_NAME}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">            -Dsonar.projectVersion=1.1 </span><span class="se">\</span>
<span class="s1">            -Dsonar.sources=. </span><span class="se">\</span>
<span class="s1">            -Dsonar.sourceEncoding=UTF-8 </span><span class="se">\</span>
<span class="s1">            -Dsonar.java.binaries=.</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="n">updateGitlabCommitStatus</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;代码质量扫描&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span>

         <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;发送到企业微信&#39;</span><span class="p">){</span>
        <span class="n">sh</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        python3 /home/blsnt/scripts/sonar.py</span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="n">updateGitlabCommitStatus</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;发送企业微信&#39;</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="host.html" class="btn btn-neutral float-left" title="第一章 如何成为有钱人" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, 小义同学

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>