

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. ] &mdash; BLSNT BLOG 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linux基础" href="../Linux/index.html" />
    <link rel="prev" title="1. #" href="Python.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> BLSNT BLOG
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python入门</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Python.html">1. #</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python.html#id1232">2. );</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">4. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id55">5. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id76">6. }</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id137">7. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id142">8. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id147">9. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id152">10. ]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id157">11. ]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Linux/index.html">Linux基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="../golang/index.html">golang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ELK/index.html">ELK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ansible/index.html">Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SaltStack/index.html">SaltStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Docker/index.html">Docker基础与使用</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BLSNT BLOG</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Python入门</a> &raquo;</li>
        
      <li><span class="section-number">3. </span>]</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Python/django.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>## django框架</p>
<p>### HTTP协议</p>
<ul>
<li><p>超文本传输协议</p></li>
<li><p>四大特性
* 基于TCP/IP之上作用于应用层的协议
* 基于请求响应
* 无状态</p>
<blockquote>
<div><ul class="simple">
<li><p>cookie</p></li>
<li><p>session</p></li>
<li><p>token</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>无连接
* websocket</p></li>
</ul>
</li>
<li><p>HTTP数据格式</p></li>
</ul>
<dl>
<dt><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python</dt><dd><dl>
<dt>http数据格式</dt><dd><dl>
<dt>请求格式</dt><dd><p>请求首行 GET /index HTTP/1.1
请求头(一大堆k,v键值对)</p>
<p>请求体(数据)</p>
</dd>
<dt>响应格式</dt><dd><p>响应首行 HTTP/1.1 200 OK
响应头(一大堆k,v键值对)</p>
<p>响应体(数据)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<ul class="simple">
<li><p>HTTP响应状态码</p></li>
</ul>
<dl class="simple">
<dt><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a></dt><dd><p>10X:服务端已经接受到你的数据了 你可以继续提交数据进行下一步操作
20X:请求成功(200)
30X:重定向(301,302)
40X:请求错误(404)
50X:服务端错误(500)</p>
</dd>
</dl>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>### python三大主流web框架</p>
<dl>
<dt><a href="#id17"><span class="problematic" id="id18">``</span></a><a href="#id19"><span class="problematic" id="id20">`</span></a>python</dt><dd><blockquote>
<div><p>a:socket服务
b:路由与视图函数映射关系
c:模板渲染</p>
</div></blockquote>
<dl class="simple">
<dt>django:大而全 类似于航空母舰</dt><dd><p>a用的别人的 wsgiref  上线之后会换成uwsgi
b自己写的
c自己写的</p>
</dd>
<dt>flask:小而精  类似于游骑兵</dt><dd><p>a用的别人的  werkzeug
b自己写的
c用的别人 jinja2</p>
</dd>
<dt>tornado:异步非阻塞</dt><dd><p>三者都是自己写的</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">`</span></a></p>
<p>#### Django安装注意事项</p>
<p><strong>注意事项</strong></p>
<blockquote>
<div><blockquote>
<div><p>1.计算机名称不能含有中文
2.一个pycharm窗口就是一个工程(项目)
3.项目文件夹不要有中文</p>
</div></blockquote>
<dl class="simple">
<dt>ps:django版本问题</dt><dd><p>django 1.X
django 2.X</p>
</dd>
</dl>
</div></blockquote>
<p><strong>安装</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">django==1.11.11</span>
<span class="pre">`</span></code></p>
<p><strong>命令行创建项目</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">django-admin</span> <span class="pre">startproject</span> <span class="pre">项目名</span>
<span class="pre">`</span></code></p>
<p>ps:创建一个应用名的文件夹 里面有一个跟应用名同名的文件夹和一个manage.py文件</p>
<p><strong>创建应用</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">django-admin</span> <span class="pre">startapp</span> <span class="pre">应用名</span>
<span class="pre">`</span></code></p>
<p><strong>启动django项目</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">python3</span> <span class="pre">manage.py</span> <span class="pre">runserver</span>
<span class="pre">`</span></code></p>
<p>注意：</p>
<p>命令创建django项目不会自动创建templates文件夹</p>
<p>settings配置文件中要添加templates的路径</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20190923235329.png">http://images.dregs.top/images/20190923235329.png</a>)</p>
<p>浏览器访问：127.0.0.1:8000</p>
<p>注意:
1.在django中创建的应用必须去settings文件中注册才能生效否则django不识别</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20190923235733.png">http://images.dregs.top/images/20190923235733.png</a>)</p>
<p>2 确保不要端口冲突</p>
<p><strong>django配置文件</strong></p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20190924000255.png">http://images.dregs.top/images/20190924000255.png</a>)</p>
<p><a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>python
项目名</p>
<blockquote>
<div><dl class="simple">
<dt>应用名文件夹</dt><dd><dl class="simple">
<dt>migrations文件夹</dt><dd><p>数据库迁移记录</p>
</dd>
<dt>admin.py</dt><dd><p>django admin后台管理相关</p>
</dd>
<dt>models.py</dt><dd><p>模型类</p>
</dd>
<dt>views.py</dt><dd><p>视图函数</p>
</dd>
</dl>
</dd>
<dt>项目同名文件夹</dt><dd><dl class="simple">
<dt>settings.py</dt><dd><p>django暴露用户可配置的配置文件</p>
</dd>
<dt>urls.py</dt><dd><p>路由与视图函数映射关系</p>
</dd>
</dl>
</dd>
<dt>templates</dt><dd><p>所有的html文件</p>
</dd>
<dt>manage.py</dt><dd><p>django入口文件</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p><strong>刚开始学习时可在配置文件中暂时禁用csrf中间件，方便表单提交测试。</strong></p>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>python
MIDDLEWARE = [</p>
<blockquote>
<div><p>‘django.middleware.security.SecurityMiddleware’,
‘django.contrib.sessions.middleware.SessionMiddleware’,
‘django.middleware.common.CommonMiddleware’,
# ‘django.middleware.csrf.CsrfViewMiddleware’,
‘django.contrib.auth.middleware.AuthenticationMiddleware’,
‘django.contrib.messages.middleware.MessageMiddleware’,
‘django.middleware.clickjacking.XFrameOptionsMiddleware’,</p>
</div></blockquote>
<div class="section" id="id37">
<h1><span class="section-number">3. </span>]<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h1>
<p>### Django基础必备三件套</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">from</span> <span class="pre">django.shortcuts</span> <span class="pre">import</span> <span class="pre">HttpResponse,</span> <span class="pre">render,</span> <span class="pre">redirect</span>
<span class="pre">`</span></code></p>
<p>定义一个index,编辑urls.py</p>
<p><a href="#id38"><span class="problematic" id="id39">``</span></a><a href="#id40"><span class="problematic" id="id41">`</span></a>python
from django.conf.urls import url
from django.contrib import admin
from app01 import views
urlpatterns = [</p>
<blockquote>
<div><p>url(r’^admin/’, admin.site.urls),
url(r’^index/’, views.index),</p>
</div></blockquote>
</div>
<div class="section" id="id42">
<h1><span class="section-number">4. </span>]<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h1>
<p>编辑views.py</p>
<p><a href="#id43"><span class="problematic" id="id44">``</span></a><a href="#id45"><span class="problematic" id="id46">`</span></a>python
from django.shortcuts import render,HttpResponse,redirect</p>
<p># Create your views here.</p>
<dl class="simple">
<dt>def index(request):</dt><dd><p>return HttpResponse(‘hello django index’)  # 返回字符串</p>
</dd>
<dt>def login(request):</dt><dd><p>return render(request,’login.html’)        # 返回html页面</p>
</dd>
<dt>def home(request):</dt><dd><p>return redirect(‘<a class="reference external" href="https://www.baidu.com">https://www.baidu.com</a>’)   # 重定向</p>
</dd>
</dl>
<p><a href="#id47"><span class="problematic" id="id48">``</span></a><a href="#id49"><span class="problematic" id="id50">`</span></a></p>
<p>浏览器访问</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20190924001132.png">http://images.dregs.top/images/20190924001132.png</a>)</p>
<p>### Django静态文件配置</p>
<p>网站所用到的已经写好的文件(css,js,图片)</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20190924182422.png">http://images.dregs.top/images/20190924182422.png</a>)</p>
<p>settings.py文件配置静态文件放置目录,添加到文件最下面</p>
<p><a href="#id51"><span class="problematic" id="id52">``</span></a><a href="#id53"><span class="problematic" id="id54">`</span></a>python
STATIC_URL = ‘/static/’   #这是接口前缀，html里面的静态文件前缀都要是static
STATICFILES_DIRS = [</p>
<blockquote>
<div><p>os.path.join(BASE_DIR,’static’)</p>
</div></blockquote>
</div>
<div class="section" id="id55">
<h1><span class="section-number">5. </span>]<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h1>
<p>动态监测接口前缀变化同步到html</p>
<dl>
<dt><a href="#id56"><span class="problematic" id="id57">``</span></a><a href="#id58"><span class="problematic" id="id59">`</span></a>python</dt><dd><blockquote>
<div><p>{% load static %}</p>
</div></blockquote>
<p>&lt;link rel=”stylesheet” href=”{% static ‘bootstrap-3.3.7/css/bootstrap.min.css’%}”&gt;
&lt;script src={% static “bootstrap-3.3.7/js/bootstrap.min.js”%}&gt;&lt;/script&gt;</p>
</dd>
</dl>
<p><a href="#id60"><span class="problematic" id="id61">``</span></a><a href="#id62"><span class="problematic" id="id63">`</span></a></p>
<p>form表单默认是get请求</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">get请求携带的参数是拼接在url后面的以?开头&amp;链接</span>
<span class="pre">ps:get请求可以携带参数</span> <span class="pre">但是参数的大小有限制</span> <span class="pre">最大4KB，并且是明文的</span>
<span class="pre">http://127.0.0.1:8000/login/?username=jason&amp;password=123</span>
<span class="pre">`</span></code></p>
<p>action参数有三种写法</p>
<blockquote>
<div><p>1.什么都不写 默认往当前页面的url地址提交
2.只写路由后缀(<strong>**</strong>)
3.写全路径</p>
</div></blockquote>
<p>登录功能</p>
<p><a href="#id64"><span class="problematic" id="id65">``</span></a><a href="#id66"><span class="problematic" id="id67">`</span></a>python
def login(request):</p>
<blockquote>
<div><dl>
<dt>if request.method == ‘POST’:</dt><dd><p># 读取post请求提交的数据</p>
<p>print(request.POST)
username = request.POST.get(‘username’)
password = request.POST.get(‘password’)  # 虽然值是一个列表，但是get方法只会获取到列表最后一个元素
# hobby = request.POST.getlist(‘xxx’)    # 如果想要获取到列表中到多个值，用getlist方法</p>
<dl class="simple">
<dt>if username == ‘blsnt’ and password == ‘123’:</dt><dd><p>return redirect(‘<a class="reference external" href="http://www.xiaohuar.com">http://www.xiaohuar.com</a>’)</p>
</dd>
</dl>
<p>return HttpResponse(‘没钱滚’)</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id68"><span class="problematic" id="id69">``</span></a><a href="#id70"><span class="problematic" id="id71">`</span></a></p>
<p>&gt; 获取用户输入的框 都必须要有name属性</p>
<p>### Django连接数据库</p>
<p>1.settings.py配置字段</p>
<p><a href="#id72"><span class="problematic" id="id73">``</span></a><a href="#id74"><span class="problematic" id="id75">`</span></a>python
DATABASES = {</p>
<blockquote>
<div><dl class="simple">
<dt>‘default’: {</dt><dd><p>‘ENGINE’: ‘django.db.backends.mysql’,
‘NAME’: ‘test’,
‘USER’: ‘root’,
‘PASSWORD’: ‘123’,
‘HOST’: ‘localhost’,
‘PORT’: ‘3306’,
‘CHARSET’: ‘utf-8’</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="id76">
<h1><span class="section-number">6. </span>}<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h1>
<p>2.去应用名下的__init__.py或者项目名下的__init__.py文件中 告诉django不要使用默认的mysqld_db模块连接mysql而是使用pymysql</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">import</span> <span class="pre">pymysql</span>
<span class="pre">pymysql.install_as_MySQLdb()</span>
<span class="pre">`</span></code></p>
<p>2.mysql-connector-python</p>
<p>　　这是mysql的官方的驱动包，对于mysql 不同版本的加密方式，不受影响。</p>
<p>　　A. 安装包: pip install mysql-connector-python</p>
<p>　　B. 修改Django 项目中的setting文件中的 ENGINE 的配置：</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20191223112014.png">http://images.dregs.top/images/20191223112014.png</a>)</p>
<p>　　C. 然后生成迁移文件，并执行迁移程序。</p>
<p>　　　　python manage.py makemigrations</p>
<p>　　　　python mangage.py migrate</p>
<p>### Django ORM</p>
<dl>
<dt><a href="#id77"><span class="problematic" id="id78">``</span></a><a href="#id79"><span class="problematic" id="id80">`</span></a>python</dt><dd><p>对象关系映射</p>
<p>类                &gt;&gt;&gt;                            数据库的表</p>
<p>对象           &gt;&gt;&gt;                                数据库里面的一条条的表记录</p>
<p>对象点属性      &gt;&gt;&gt;                          表记录的某个字段对应的值</p>
</dd>
</dl>
<p><a href="#id81"><span class="problematic" id="id82">``</span></a><a href="#id83"><span class="problematic" id="id84">`</span></a></p>
<p>&gt; 能够让一个不会数据库操作的人 也能够通过编程语言轻松的操作数据库,有时候sql语句的查询效率可能偏低</p>
<p>注意事项：</p>
<p>1.models.py中写模型类</p>
<p>2.执行数据库同步命令</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">python3</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span>&#160;&#160; <span class="pre">#将数据的更改操作记录到小本本上</span>
<span class="pre">python3</span> <span class="pre">manage.py</span> <span class="pre">migrate</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">#将更改真正同步到数据库</span>
<span class="pre">`</span></code></p>
<p>&gt; 不能创建库，只能创建表</p>
<p>#### ORM 查询操作</p>
<p>views.py将前端传入的用户名和密码拿出来做if判断数据库是否有这个用户</p>
<p><a href="#id85"><span class="problematic" id="id86">``</span></a><a href="#id87"><span class="problematic" id="id88">`</span></a>python
form app01 import models
def login(request):</p>
<blockquote>
<div><p>print(request.method)  # 获取当前请求方式
if request.method == ‘POST’:</p>
<blockquote>
<div><p># user_obj = models.User.objects.filter(username=username)
# print(user_obj.query) # 获取sql语句</p>
<p># user_obj = models.User.objects.filter(username=username)[0]  # 支持正向索引,不推荐</p>
<p># user_obj = models.User.objects.filter(username=username)[-1] # 不支持负数索引</p>
<p># user_obj = models.User.objects.filter(username=username).first()  # 推荐使用first获取对象</p>
<p>is_alive = models.User.objects.filter(username=username,password=password)  # filter支持传多个参数 并且是and的关系
if is_alive:</p>
<blockquote>
<div><p>return HttpResponse(‘登录成功’)</p>
</div></blockquote>
<p>return HttpResponse(‘登录失败’)
# select id,username,password from user where username=’jason’ and password = ‘123’
“””
filter方法
当条件存在的时候 &lt;QuerySet [&lt;User: User object&gt;]&gt;        jQuery对象与原生js对象之间的关系
条件不存再 &lt;QuerySet []&gt;
“””
# print(user_obj)
# print(user_obj.id)
# print(user_obj.pk)  # pk会自动查找当前对象的主键字段
# print(user_obj.username)
# print(user_obj.password)
# print(hobby,type(hobby))
# print(username,type(username))
# print(password,type(password))</p>
</div></blockquote>
<p>return render(request,’login.html’)</p>
</div></blockquote>
<p><a href="#id89"><span class="problematic" id="id90">``</span></a><a href="#id91"><span class="problematic" id="id92">`</span></a></p>
<p>#### 模型表字段的增删改查</p>
<p>models.py跟数据库相关的操作都在这个文件里面</p>
<p><a href="#id93"><span class="problematic" id="id94">``</span></a><a href="#id95"><span class="problematic" id="id96">`</span></a>python
from django.db import models</p>
<p># Create your models here.</p>
<dl class="simple">
<dt>class User(models.Model):</dt><dd><p>username = models.CharField(max_length=32)
password = models.CharField(max_length=32)
addr = models.CharField(max_length=32,null=True) # 只要修改了models.py中跟数据库相关的数据，必须重新执行数据库的两条迁移命令
# email = models.EmailField(null=True)            # 要删除这个数据，直接#然后再执行两条数据库迁移命令即可</p>
</dd>
</dl>
<p><a href="#id97"><span class="problematic" id="id98">``</span></a><a href="#id99"><span class="problematic" id="id100">`</span></a></p>
<p>&gt; python3 manage.py makemigrations  将数据的更改操作记录到小本本上
&gt;
&gt; python3 manage.py migrate  将更改真正同步到数据库</p>
<p>#### 数据的增删改查</p>
<p><a href="#id101"><span class="problematic" id="id102">``</span></a><a href="#id103"><span class="problematic" id="id104">`</span></a>python
def register(request):</p>
<blockquote>
<div><dl>
<dt>if request.method == ‘POST’:</dt><dd><p>username = request.POST.get(‘username’)
password = request.POST.get(‘password’)
addr = request.POST.get(‘addr’)</p>
<p># orm创建数据
# 第一种
# models.User.objects.create(username=username,password=password,addr=addr)</p>
<p># 第二种
user_obj = models.User()
user_obj.username = username
user_obj.password = password
user_obj.addr = addr
user_obj.save() # 保存到数据库</p>
<p>return redirect(‘/user_list’)   # 注册完数据跳转到展示页面</p>
</dd>
</dl>
<p>return render(request,’register.html’)</p>
</div></blockquote>
<dl>
<dt>def user_list(request):</dt><dd><p># 获取表所有到数据
data = models.User.objects.all()  # select id,username,password,addr from user</p>
<p># return render(request,’list_html’,{‘data’:data}) # 第一种给页面传值的方式
return render(request,’list_html’,locals()) # 会将当前名称空间中的所有的名字都传递给前端</p>
</dd>
</dl>
<p><a href="#id105"><span class="problematic" id="id106">``</span></a><a href="#id107"><span class="problematic" id="id108">`</span></a></p>
<p>编辑数据</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20191022024543.png">http://images.dregs.top/images/20191022024543.png</a>)</p>
<p><a href="#id109"><span class="problematic" id="id110">``</span></a><a href="#id111"><span class="problematic" id="id112">`</span></a>python
def edit(request):</p>
<blockquote>
<div><dl class="simple">
<dt>if request.method == ‘POST’:</dt><dd><p>edit_id = request.GET.get(‘id’)
username = request.POST.get(‘username’)
password = request.POST.get(‘password’)
addr = request.POST.get(‘addr’)
# queryset对象 可以直接调用update方法进行批量更新  如果queryset对象中有多个数据对象 那么会将多个数据对象全部更新
# 第一种更新方式
models.User.objects.filter(pk=edit_id).update(username=username,password=password,addr=addr)
# 第二种更新方式
# edit_obj = models.User.objects.filter(pk=edit_id).first()
# edit_obj.username = username
# edit_obj.password = password
# edit_obj.addr = addr
# edit_obj.save()  # 不推荐使用  它是从头到尾重新写一遍
return redirect(‘/user_list’)</p>
</dd>
</dl>
<p># print(request.GET)  # 获取get请求携带参数
edit_id = request.GET.get(‘id’)
# 查询该主键对应的数据对象
edit_obj = models.User.objects.filter(pk=edit_id).first()
return render(request,’edit.html’,locals())</p>
</div></blockquote>
<p><a href="#id113"><span class="problematic" id="id114">``</span></a><a href="#id115"><span class="problematic" id="id116">`</span></a></p>
<p>删除数据</p>
<p><a href="#id117"><span class="problematic" id="id118">``</span></a><a href="#id119"><span class="problematic" id="id120">`</span></a>python
def delete(request):</p>
<blockquote>
<div><p>delete_id = request.GET.get(‘id’)
models.User.objects.filter(pk=delete_id).delete()  # 批量删除
return redirect(‘/user_list’)</p>
</div></blockquote>
<p><a href="#id121"><span class="problematic" id="id122">``</span></a><a href="#id123"><span class="problematic" id="id124">`</span></a></p>
<p>### Django URL路由系统</p>
<p>#### 路由基本使用</p>
<p><a href="#id125"><span class="problematic" id="id126">``</span></a><a href="#id127"><span class="problematic" id="id128">`</span></a>python
urlpatterns = [</p>
<blockquote>
<div><dl>
<dt>url(r’^admin/’, admin.site.urls),</dt><dd><blockquote>
<div><p>url(r’^test/$’, views.test),</p>
</div></blockquote>
<p>url(r’testadd/’, views.testadd),</p>
</dd>
</dl>
</div></blockquote>
<p>]
# url的第一个参数 其实是一个正则表达式
# 获取用户输入的url 然后根据正则匹配 是否对应
# urls中只要匹配到了 就会立刻执行对应的函数 不会在往下继续匹配
# 第一次如果都没有匹配上的话 会自动加/再次匹配 如果还匹配不上直接报错
<a href="#id129"><span class="problematic" id="id130">``</span></a><a href="#id131"><span class="problematic" id="id132">`</span></a></p>
<p>无名分组</p>
<p><a href="#id133"><span class="problematic" id="id134">``</span></a><a href="#id135"><span class="problematic" id="id136">`</span></a>python
urlpatterns = [</p>
<blockquote>
<div><p>url(r’^admin/’, admin.site.urls),
# 无名分组，会将分组内到结果，当作位置参数自动传递给后面的视图函数</p>
<blockquote>
<div><p>url(r’^test/([0-9]{4})/$’, views.test),</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="id137">
<h1><span class="section-number">7. </span>]<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h1>
<p>有名分组</p>
<p><a href="#id138"><span class="problematic" id="id139">``</span></a><a href="#id140"><span class="problematic" id="id141">`</span></a>python
urlpatterns = [</p>
<blockquote>
<div><p>url(r’^admin/’, admin.site.urls),
# 无名分组，会将分组内到结果，当作关键字参数自动传递给后面的视图函数</p>
<blockquote>
<div><p>url(r’^test/(?p&lt;id&gt;[0-9]{4})/$’, views.test),</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="id142">
<h1><span class="section-number">8. </span>]<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h1>
<p>#### 反向解析</p>
<p>根据别名动态解析出可以匹配上视图函数</p>
<p>#### 伪静态</p>
<p>让一个动态页面伪装成一个看似已经写死了的页面</p>
<p><a href="#id143"><span class="problematic" id="id144">``</span></a><a href="#id145"><span class="problematic" id="id146">`</span></a>python
urlpatterns = [</p>
<blockquote>
<div><p>url(r’^admin/’, admin.site.urls),
url(r’^register.html’, views.register)</p>
</div></blockquote>
</div>
<div class="section" id="id147">
<h1><span class="section-number">9. </span>]<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h1>
<p>### 虚拟环境</p>
<p>针对不同的项目，只下载对应项目的模块</p>
<p>![](<a class="reference external" href="http://images.dregs.top/images/20191023014412.png">http://images.dregs.top/images/20191023014412.png</a>)</p>
<p>#### 简单实用无名分组来获取URL中的动态参数</p>
<p>URL配置(URLconf)就像Django 所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表；你就是以这种方式告诉Django，对于这个URL调用这段代码，对于那个URL调用那段代码。</p>
<p><a href="#id148"><span class="problematic" id="id149">``</span></a><a href="#id150"><span class="problematic" id="id151">`</span></a>python
urlpatterns = [</p>
<blockquote>
<div><p>url(正则表达式, views视图函数，参数，别名),</p>
</div></blockquote>
</div>
<div class="section" id="id152">
<h1><span class="section-number">10. </span>]<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h1>
<p>参数说明：</p>
<ul class="simple">
<li><p>一个正则表达式字符串</p></li>
<li><p>一个可调用对象，通常为一个视图函数或一个指定视图函数路径的字符串</p></li>
<li><p>可选的要传递给视图函数的默认参数（字典形式）</p></li>
<li><p>一个可选的name参数</p></li>
</ul>
<p>urls.py</p>
<p><a href="#id153"><span class="problematic" id="id154">``</span></a><a href="#id155"><span class="problematic" id="id156">`</span></a>python
from django.conf.urls import url
from django.contrib import admin
from app01 import views
urlpatterns = [</p>
<blockquote>
<div><p>url(r’^admin/’, admin.site.urls),
url(r’^index/2003/$’, views.index),           #一定要注意路径是否会被前面到捕捉到
url(r’^articles/([0-9]{4})$’, views.year_archive), #year_archive(request,2006)
url(r’^articles/([0-9]{4})/([0-9]{2})$’, views.month_archive), #year_archive(request,2006,12)
url(r’^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$’, views.article_detail), #year_archive(request,2006,12,99)</p>
</div></blockquote>
</div>
<div class="section" id="id157">
<h1><span class="section-number">11. </span>]<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h1>
<p>views.py</p>
<p><a href="#id158"><span class="problematic" id="id159">``</span></a><a href="#id160"><span class="problematic" id="id161">`</span></a>python
from django.shortcuts import render,HttpResponse,redirect</p>
<p># Create your views here.</p>
<dl class="simple">
<dt>def index(request):</dt><dd><p>return HttpResponse(‘hello django index’)</p>
</dd>
<dt>def year_archive(request,year):</dt><dd><p>return HttpResponse(year)</p>
</dd>
<dt>def month_archive(request,year,month):</dt><dd><p>return HttpResponse(‘year:%s month:%s’ %(year,month))</p>
</dd>
<dt>def article_detail(request,year,month,article):</dt><dd><p>return  HttpResponse(‘year:%s month:%s article:%s’ %(year,month,article))</p>
</dd>
</dl>
<p><a href="#id162"><span class="problematic" id="id163">``</span></a><a href="#id164"><span class="problematic" id="id165">`</span></a></p>
<p>#### 简单实用有名分组来获取URL中的动态参数</p>
<p>urls.py 会把分组内的结果，当做位置参数自动传递给后面的视图函数</p>
<p><a href="#id166"><span class="problematic" id="id167">``</span></a><a href="#id168"><span class="problematic" id="id169">`</span></a>python
from django.conf.urls import url</p>
<p>from . import views</p>
<dl class="simple">
<dt>urlpatterns = [</dt><dd><p>url(r’^articles/2003/$’, views.special_case_2003),
url(r’^articles/(?P&lt;year&gt;[0-9]{4})/$’, views.year_archive),
url(r’^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/$’, views.month_archive),
url(r’^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/(?P&lt;day&gt;[0-9]{2})/$’, views.article_detail),</p>
</dd>
</dl>
<dl class="simple">
<dt>]</dt><dd><p>#通过?p&lt;&gt;给分组起名字，传参到views里面，跟关键字传参一样</p>
</dd>
</dl>
<p><a href="#id170"><span class="problematic" id="id171">``</span></a><a href="#id172"><span class="problematic" id="id173">`</span></a></p>
<p>views.py 参数名字要跟urls分组里面的名字一样</p>
<p><a href="#id174"><span class="problematic" id="id175">``</span></a><a href="#id176"><span class="problematic" id="id177">`</span></a>python
from django.shortcuts import render,HttpResponse,redirect</p>
<p># Create your views here.</p>
<dl class="simple">
<dt>def index(request):</dt><dd><p>return HttpResponse(‘hello django index’)</p>
</dd>
<dt>def year_archive(request,year):</dt><dd><p>return HttpResponse(year)</p>
</dd>
<dt>def month_archive(request,year,month):</dt><dd><p>return HttpResponse(‘year:%s month:%s’ %(year,month))</p>
</dd>
<dt>def article_detail(request,year,month,article): #不管参数位置怎么变，参数还是对应的，不会走位置</dt><dd><p>return  HttpResponse(‘year:%s month:%s article:%s’ %(year,month,article))</p>
</dd>
</dl>
<p><a href="#id178"><span class="problematic" id="id179">``</span></a><a href="#id180"><span class="problematic" id="id181">`</span></a></p>
<p>#### 路由分发</p>
<p><a href="#id182"><span class="problematic" id="id183">``</span></a><a href="#id184"><span class="problematic" id="id185">`</span></a>python
#At any point, your urlpatterns can “include” other URLconf modules. This
#essentially “roots” a set of URLs below other ones.</p>
<p>#For example, here’s an excerpt of the URLconf for the Django website itself.
#It includes a number of other URLconfs:
from django.conf.urls import include, url</p>
<dl class="simple">
<dt>urlpatterns = [</dt><dd><p>url(r’^admin/’, admin.site.urls),
url(r’^blog/’, include(‘blog.urls’)), #以blog开头的分发到blog里面的urls</p>
</dd>
</dl>
<p>]
#要先创建这个应用，然后include这个应用的路由
# ^?匹配根目录
<a href="#id186"><span class="problematic" id="id187">``</span></a><a href="#id188"><span class="problematic" id="id189">`</span></a></p>
<p>小结：</p>
<dl class="simple">
<dt><a href="#id190"><span class="problematic" id="id191">``</span></a><a href="#id192"><span class="problematic" id="id193">`</span></a>python</dt><dd><p>NOTE:
1 一旦匹配成功则不再继续
2 若要从URL 中捕获一个值，只需要在它周围放置一对圆括号。
3 不需要添加一个前导的反斜杠，因为每个URL 都有。例如，应该是^articles 而不是 ^/articles。
4 每个正则表达式前面的’r’ 是可选的但是建议加上。</p>
</dd>
</dl>
<p>一些请求的例子：</p>
<blockquote>
<div><p>/articles/2005/3/ 不匹配任何URL 模式，因为列表中的第三个模式要求月份应该是两个数字。
/articles/2003/ 将匹配列表中的第一个模式不是第二个，因为模式按顺序匹配，第一个会首先测试是否匹配。
/articles/2005/03/ 请求将匹配列表中的第三个模式。Django 将调用函数</p>
<blockquote>
<div><p>views.month_archive(request, ‘2005’, ‘03’)。</p>
</div></blockquote>
</div></blockquote>
<p>#设置项是否开启URL访问地址后面不为/跳转至带有/的路径
APPEND_SLASH=True
<a href="#id194"><span class="problematic" id="id195">``</span></a><a href="#id196"><span class="problematic" id="id197">`</span></a></p>
<p>#### 反向解析</p>
<p><a href="#id198"><span class="problematic" id="id199">``</span></a><a href="#id200"><span class="problematic" id="id201">`</span></a>python</p>
<blockquote>
<div><dl>
<dt>反向解析</dt><dd><p>注意:在起别名的时候 一定要保证 所有的别名都不能重复  必须是唯一的</p>
<p>根据别名动态解析出可以匹配上视图函数之前的url的一个结果
url(r’^testxxx/’,views.test,name=’t’)
url(r’^test/(d+)/$’,views.test,name=’ttt’),
前端</p>
<blockquote>
<div><p>没有正则表达式的反向解析
{% url ‘t’ %}
无名分组反向解析
{% url ‘ttt’ 1 %}
有名分组同上</p>
</div></blockquote>
<dl class="simple">
<dt>后端</dt><dd><p>from django.shortcuts import render,HttpResponse,redirect,reverse
没有正则表达式的反向解析
reverse(‘t’)
无名分组反向解析
reverse(‘ttt’,args=(1,))
有名分组同上</p>
</dd>
</dl>
<p>ps:数字通常是数据库中查出来的数据的主键值</p>
</dd>
</dl>
</div></blockquote>
<p><a href="#id202"><span class="problematic" id="id203">``</span></a><a href="#id204"><span class="problematic" id="id205">`</span></a></p>
<p>### 伪静态</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">让一个动态页面伪装成一个看似数据已经写死了的静态页面</span>
<span class="pre">让搜索引擎加大对你这个页面的搜藏力度</span>
<span class="pre">`</span></code></p>
<p>### 虚拟环境</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">虚拟环境就类似于你又下载了一个python解释器</span>
<span class="pre">`</span></code></p>
<p>### Django版本区别</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">1.x</span> <span class="pre">路由里面用的是url()</span>
<span class="pre">2.x</span> <span class="pre">路由里面用的是path(),url第一个参数放的是正则表达式，而path第一个参数写什么就是什么，不支持郑泽如果你还想用正则，django2.x版本中有一个re_path(),等价于1.x中的url</span>
<span class="pre">`</span></code></p>
<p>### JsonResponse</p>
<p><a href="#id206"><span class="problematic" id="id207">``</span></a><a href="#id208"><span class="problematic" id="id209">`</span></a>python
from django.http import JsonResponse
import json</p>
<p>def index(request):</p>
<blockquote>
<div><p>d = {‘name’:’json’,’password’:’123’,’hobby’:’读书’}
# 方式一:
# return HttpResponse(json.dumps(d))
# 方式二:
return JsonResponse(d,json_dumps_params={‘ensure_ascii’:False}) # 返回给前端就能显示中文读书</p>
</div></blockquote>
<p><a href="#id210"><span class="problematic" id="id211">``</span></a><a href="#id212"><span class="problematic" id="id213">`</span></a></p>
<p>注意：</p>
<p><a href="#id214"><span class="problematic" id="id215">``</span></a><a href="#id216"><span class="problematic" id="id217">`</span></a>python
import json</p>
<p>d = {‘name’: ‘json’, ‘password’: ‘123’, ‘hobby’: ‘读书’}
print(json.dumps(d,ensure_ascii=False))  # 原样输出中文读书
<a href="#id218"><span class="problematic" id="id219">``</span></a><a href="#id220"><span class="problematic" id="id221">`</span></a></p>
<p>### Django Views（视图函数）</p>
<p>一个视图函数，简称视图，是一个简单的Python 函数，它接受Web请求并且返回Web响应。响应可以是一张网页的HTML内容，一个重定向，一个404错误，一个XML文档，或者一张图片… 是任何东西都可以。无论视图本身包含什么逻辑，都要返回响应。代码写在哪里也无所谓，只要它在你的Python目录下面。除此之外没有更多的要求了——可以说“没有什么神奇的地方”。为了将代码放在某处，约定是将视图放置在项目或应用程序目录中的名为`views.py`的文件中。</p>
<p>#### <strong>request属性</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">request.method</span> <span class="pre">#请求方式</span>
<span class="pre">request.path</span>&#160;&#160; <span class="pre">#请求路径</span>
<span class="pre">request.POST</span>&#160;&#160; <span class="pre">#POST的请求数据</span> <span class="pre">字典格式</span>
<span class="pre">request.GET</span>&#160;&#160;&#160; <span class="pre">#GET的请求数据</span> <span class="pre">字典格式</span>
<span class="pre">request.META.</span>&#160; <span class="pre">#请求头</span>
<span class="pre">request.get_full_path()</span>&#160; <span class="pre">#</span>
<span class="pre">`</span></code></p>
<p>#### HttpResponse对象</p>
<p>Django对于一定最后响应一个httpResponse的实例对象</p>
<p>三种形式：</p>
<ol class="arabic simple">
<li><p>httpResponse(‘字符串’)</p></li>
<li><p>render(‘页面’)</p></li>
<li><p>redirect(重定向)</p></li>
</ol>
<p>传递要重定向的一个硬编码的URL</p>
<p><a href="#id222"><span class="problematic" id="id223">``</span></a><a href="#id224"><span class="problematic" id="id225">`</span></a>python
def my_view(request):</p>
<blockquote>
<div><p>…
return redirect(‘/some/url/’)</p>
</div></blockquote>
<p><a href="#id226"><span class="problematic" id="id227">``</span></a><a href="#id228"><span class="problematic" id="id229">`</span></a></p>
<p>也可以是一个完整的URL</p>
<p><a href="#id230"><span class="problematic" id="id231">``</span></a><a href="#id232"><span class="problematic" id="id233">`</span></a>python
def my_view(request):</p>
<blockquote>
<div><p>…
return redirect(‘<a class="reference external" href="http://example.com/">http://example.com/</a>’)</p>
</div></blockquote>
<p><a href="#id234"><span class="problematic" id="id235">``</span></a><a href="#id236"><span class="problematic" id="id237">`</span></a></p>
<p>两次请求</p>
<p><a href="#id238"><span class="problematic" id="id239">``</span></a><a href="#id240"><span class="problematic" id="id241">`</span></a>python
1）301和302的区别。
　　301和302状态码都表示重定向，就是说浏览器在拿到服务器返回的这个状态码后会自动跳转到一个新的URL地址，这个地址可以从响应的Location首部中获取</p>
<blockquote>
<div><p>（用户看到的效果就是他输入的地址A瞬间变成了另一个地址B）——这是它们的共同点。</p>
</div></blockquote>
<p>　　他们的不同在于。301表示旧地址A的资源已经被永久地移除了（这个资源不可访问了），搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址；
　　302表示旧地址A的资源还在（仍然可以访问），这个重定向只是临时地从旧地址A跳转到地址B，搜索引擎会抓取新的内容而保存旧的网址。 SEO302好于301</p>
<p>2）重定向原因：
（1）网站调整（如改变网页目录结构）；
（2）网页被移到一个新地址；
（3）网页扩展名改变(如应用需要把.php改成.Html或.shtml)。</p>
<blockquote>
<div><blockquote>
<div><p>这种情况下，如果不做重定向，则用户收藏夹或搜索引擎数据库中旧地址只能让访问客户得到一个404页面错误信息，访问流量白白丧失；再者某些注册了多个域名的</p>
</div></blockquote>
<p>网站，也需要通过重定向让访问这些域名的用户自动跳转到主站点等。</p>
</div></blockquote>
<p><a href="#id242"><span class="problematic" id="id243">``</span></a><a href="#id244"><span class="problematic" id="id245">`</span></a></p>
<p>### Django 模板语法</p>
<p>### <strong>模板语法之变量</strong></p>
<p><a href="#id246"><span class="problematic" id="id247">``</span></a><a href="#id248"><span class="problematic" id="id249">`</span></a>python
def index(request):</p>
<blockquote>
<div><p>import datetime
s=”hello”
l=[111,222,333]    # 列表
dic={“name”:”yuan”,”age”:18}  # 字典
date = datetime.date(1993, 5, 2)   # 日期对象</p>
<dl class="simple">
<dt>class Person(object):</dt><dd><dl class="simple">
<dt>def __init__(self,name):</dt><dd><p>self.name=name</p>
</dd>
</dl>
</dd>
</dl>
<p>person_yuan=Person(“yuan”)  # 自定义类对象
person_egon=Person(“egon”)
person_alex=Person(“alex”)</p>
<p>person_list=[person_yuan,person_egon,person_alex]</p>
<p>return render(request,”index.html”,{“l”:l,”dic”:dic,”date”:date,”person_list”:person_list})</p>
</div></blockquote>
<p><a href="#id250"><span class="problematic" id="id251">``</span></a><a href="#id252"><span class="problematic" id="id253">`</span></a></p>
<p><strong>template：</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">&lt;h4&gt;{{s}}&lt;/h4&gt;</span>
<span class="pre">&lt;h4&gt;列表:{{</span> <span class="pre">l.0</span> <span class="pre">}}&lt;/h4&gt;</span>
<span class="pre">&lt;h4&gt;列表:{{</span> <span class="pre">l.2</span> <span class="pre">}}&lt;/h4&gt;</span>
<span class="pre">&lt;h4&gt;字典:{{</span> <span class="pre">dic.name</span> <span class="pre">}}&lt;/h4&gt;</span>
<span class="pre">&lt;h4&gt;日期:{{</span> <span class="pre">date.year</span> <span class="pre">}}&lt;/h4&gt;</span>
<span class="pre">&lt;h4&gt;类对象列表:{{</span> <span class="pre">person_list.0.name</span> <span class="pre">}}&lt;/h4&gt;</span>
<span class="pre">`</span></code></p>
<p>注意：句点符也可以用来引用对象的方法(无参数方法):</p>
<p>#### 模板传值</p>
<p><a href="#id254"><span class="problematic" id="id255">``</span></a>`
第一种</p>
<blockquote>
<div><p>return render(request,’demo.html’,{‘xxx’:[1,2,3,4]})</p>
</div></blockquote>
<dl class="simple">
<dt>第二种</dt><dd><p>return render(request,’demo.html’,locals())</p>
</dd>
</dl>
<p># 如果是函数名，传递到前端，会自动加括号执行，将结果传递到前端
<a href="#id256"><span class="problematic" id="id257">``</span></a><a href="#id258"><span class="problematic" id="id259">`</span></a></p>
<p>#### 模板之过滤器</p>
<p>语法：</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{obj|filter__name:parm}}</span>
<span class="pre">`</span></code></p>
<p><strong>default</strong></p>
<p>如果是一个变量是false或者为空，使用给定的默认值，否则，使用变量的值</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{</span> <span class="pre">value|default:&quot;nothing&quot;</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p><strong>Length</strong></p>
<p>返回值的长度，它对字符串呵列表都起作用</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{</span> <span class="pre">value|length</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p>如果 value 是 [‘a’, ‘b’, ‘c’, ‘d’]，那么输出是 4。</p>
<p><strong>filesizeformat</strong></p>
<p>将值格式化为一个 “人类可读的” 文件尺寸 （例如 <cite>‘13 KB’</cite>, <cite>‘4.1 MB’</cite>, <cite>‘102 bytes’</cite>, 等等）。例如：</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{</span> <span class="pre">value|filesizeformat</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p>如果 <cite>value</cite> 是 123456789，输出将会是 <cite>117.7 MB</cite>。</p>
<p><strong>date</strong></p>
<p>如果 value=datetime.datetime.now()</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{</span> <span class="pre">value|date:&quot;Y-m-d&quot;</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p><strong>slice</strong></p>
<p>如果 value=”hello world”</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">{{</span> <span class="pre">value|slice:&quot;2:-1&quot;</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p><strong>truncatechars</strong></p>
<p>如果字符串字符多于指定的字符数量，那么会被截断。截断的字符串将以可翻译的省略号序列（“…”）结尾。</p>
<p><a href="#id260"><span class="problematic" id="id261">**</span></a>参数：<a href="#id262"><span class="problematic" id="id263">**</span></a>要截断的字符数</p>
<p>例如：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">{{</span> <span class="pre">value|truncatechars:9</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p><strong>safe</strong></p>
<p>Django的模板中会对HTML标签和JS等语法标签进行自动转义，原因显而易见，这样是为了安全。但是有的时候我们可能不希望这些HTML元素被转义，比如我们做一个内容管理系统，后台添加的文章中是经过修饰的，这些修饰可能是通过一个类似于FCKeditor编辑加注了HTML修饰符的文本，如果自动转义的话显示的就是保护HTML标签的源文件。为了在Django中关闭HTML的自动转义有两种方式，如果是一个单独的变量我们可以通过过滤器“<a href="#id264"><span class="problematic" id="id265">|</span></a>safe”的方式告诉Django这段代码是安全的不必转义。比如：</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">value=&quot;&lt;a</span> <span class="pre">href=&quot;&quot;&gt;点击&lt;/a&gt;&quot;</span>
<span class="pre">{{</span> <span class="pre">value|safe</span> <span class="pre">}}</span>
<span class="pre">`</span></code></p>
<p>#### 模板之标签</p>
<p>标签看起来像是这样的： <cite>{% tag %}</cite>。标签比变量更加复杂：一些在输出中创建文本，一些通过循环或逻辑来控制流程，一些加载其后的变量将使用到的额外信息到模版中。一些标签需要开始和结束标签 （例如`{% tag %} …`标签 内容 … {% endtag %}）。</p>
<p><strong>for标签</strong></p>
<p>遍历每一个元素</p>
<p><a href="#id266"><span class="problematic" id="id267">``</span></a><a href="#id268"><span class="problematic" id="id269">`</span></a>python
{% for person in person_list %}</p>
<blockquote>
<div><p>&lt;p&gt;{{ person }}&lt;/p&gt;</p>
</div></blockquote>
<p>{% endfor %}
<a href="#id270"><span class="problematic" id="id271">``</span></a><a href="#id272"><span class="problematic" id="id273">`</span></a></p>
<p>可以利用`{% for obj in list reversed %}`反向完成循环。</p>
<p>遍历一个字典：</p>
<p><a href="#id274"><span class="problematic" id="id275">``</span></a><a href="#id276"><span class="problematic" id="id277">`</span></a>python
{% for key,val in dic.items %}</p>
<blockquote>
<div><p>&lt;p&gt;{{ key }}:{{ val }}&lt;/p&gt;</p>
</div></blockquote>
<p>{% endfor %}
<a href="#id278"><span class="problematic" id="id279">``</span></a><a href="#id280"><span class="problematic" id="id281">`</span></a></p>
<p>注：循环序号可以通过｛｛forloop｝｝显示</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">forloop.counter</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">The</span> <span class="pre">current</span> <span class="pre">iteration</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">loop</span> <span class="pre">(1-indexed)</span>
<span class="pre">forloop.counter0</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">The</span> <span class="pre">current</span> <span class="pre">iteration</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">loop</span> <span class="pre">(0-indexed)</span>
<span class="pre">forloop.revcounter</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">The</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">iterations</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">end</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">loop</span> <span class="pre">(1-indexed)</span>
<span class="pre">forloop.revcounter0</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">The</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">iterations</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">end</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">loop</span> <span class="pre">(0-indexed)</span>
<span class="pre">forloop.first</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">True</span> <span class="pre">if</span> <span class="pre">this</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">time</span> <span class="pre">through</span> <span class="pre">the</span> <span class="pre">loop</span>
<span class="pre">forloop.last</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">True</span> <span class="pre">if</span> <span class="pre">this</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">last</span> <span class="pre">time</span> <span class="pre">through</span> <span class="pre">the</span> <span class="pre">loop</span>
<span class="pre">`</span></code></p>
<p><strong>if  标签</strong></p>
<p><a href="#id282"><span class="problematic" id="id283">`</span></a>{% if %}`会对一个变量求值，如果它的值是“True”（存在、不为空、且不是boolean类型的false值），对应的内容块会输出。</p>
<p><a href="#id284"><span class="problematic" id="id285">``</span></a><a href="#id286"><span class="problematic" id="id287">`</span></a>python
{% if num &gt; 100 or num &lt; 0 %}</p>
<blockquote>
<div><p>&lt;p&gt;无效&lt;/p&gt;</p>
</div></blockquote>
<dl class="simple">
<dt>{% elif num &gt; 80 and num &lt; 100 %}</dt><dd><p>&lt;p&gt;优秀&lt;/p&gt;</p>
</dd>
<dt>{% else %}</dt><dd><p>&lt;p&gt;凑活吧&lt;/p&gt;</p>
</dd>
</dl>
<p>{% endif %}
<a href="#id288"><span class="problematic" id="id289">``</span></a><a href="#id290"><span class="problematic" id="id291">`</span></a></p>
<p><strong>with</strong></p>
<p>使用一个简单地名字缓存一个复杂的变量，当你需要使用一个“昂贵的”方法（比如访问数据库）很多次的时候是非常有用的</p>
<p>例如：</p>
<p><a href="#id292"><span class="problematic" id="id293">``</span></a><a href="#id294"><span class="problematic" id="id295">`</span></a>python
{% with total=business.employees.count %}</p>
<blockquote>
<div><p>{{ total }} employee{{ total|pluralize }}</p>
</div></blockquote>
<p>{% endwith %}
<a href="#id296"><span class="problematic" id="id297">``</span></a><a href="#id298"><span class="problematic" id="id299">`</span></a></p>
<p><strong>csrf_token</strong></p>
<p>这个标签用于跨站请求伪造保护,加到form表单即可</p>
<p>#### 模版继承</p>
<p>Django模版引擎中最强大也是最复杂的部分就是模版继承了。模版继承可以让您创建一个基本的“骨架”模版，它包含您站点中的全部元素，并且可以定义能够被子模版覆盖的 blocks 。</p>
<p>通过从下面这个例子开始，可以容易的理解模版继承：</p>
<p>### Django 模型层</p>
<p>单独测试django里面某个功能</p>
<p>将manage.py里面的四段拷贝到tests.py里面</p>
<p><a href="#id300"><span class="problematic" id="id301">``</span></a><a href="#id302"><span class="problematic" id="id303">`</span></a>python
import os
import sys</p>
<dl class="simple">
<dt>if __name__ == “__main__”:</dt><dd><p>os.environ.setdefault(“DJANGO_SETTINGS_MODULE”, “mysite.settings”)
import django
django.setup()</p>
</dd>
</dl>
<p><a href="#id304"><span class="problematic" id="id305">``</span></a><a href="#id306"><span class="problematic" id="id307">`</span></a></p>
<p>针对单表操作</p>
<p><a href="#id308"><span class="problematic" id="id309">``</span></a><a href="#id310"><span class="problematic" id="id311">`</span></a>python
from django.test import TestCase</p>
<p># Create your tests here.
import json
import os
import sys</p>
<dl>
<dt>if __name__ == “__main__”:</dt><dd><p>os.environ.setdefault(“DJANGO_SETTINGS_MODULE”, “mysite.settings”)
import django
django.setup()</p>
<p>from app01 import models</p>
<p># 增加数据
models.BookList.objects.create(title=’三国演义’,price=123.23,publish_date=’2019-09-26’)</p>
<p># 加入时间戳
import datetime
ctime = datetime.date.today()
models.BookList.objects.create(title=’红楼梦’,price=’1666.23’,publish_date=ctime)</p>
<p># 修改
models.BookList.objects.filter(title=’三国演义’).update(price=1123.23)</p>
<p># 查询
models.BookList.objects.all()
models.BookList.objects.filter(pk=1) # 推荐使用
models.BookList.objects.get(pk=2)  # get获取到到就是数据对象本身，但是当条件不满足的时候，会直接报错，不推荐使用</p>
<p># 删除
models.BookList.objects.filter(pk=1).delete()</p>
<p># 反向查找
models.BookList.objects.exists(pk=1) # 取反</p>
<p># 只拿数据的某几个字段
models.BookList.objects.values(‘title’,’price’)</p>
<blockquote>
<div><p># vales返回的是列表套字典</p>
</div></blockquote>
<dl class="simple">
<dt>models.BookList.objects.values_list(‘title’,’price’)</dt><dd><p># vales_list返回的是列表套元祖</p>
</dd>
</dl>
<p># 对数据进行排序
models.BookList.objects.order_by(‘price’)</p>
<blockquote>
<div><p># 默认是升序，从小到大</p>
</div></blockquote>
<dl class="simple">
<dt>models.BookList.objects.order_by(‘price’).reverse()</dt><dd><p># 反转，从大到小</p>
</dd>
</dl>
<p># 去重(前提是：数据必须一样)
models.BookList.objects.filter(title=’三国演义’).values(‘price’,’title’).distinct()</p>
<p># 统计
models.BookList.objects.all().count()</p>
<p># 如果QuerySet包含数据，就返回True，否则返回False
models.BookList.objects.filter(pk=2).exists()</p>
<p># 查询价格大于2000的
models.BookList.objects.filter(price__gt=2000)</p>
<p># 查询价格小于2000的
models.BookList.objects.filter(price__lt=2000)</p>
<p># 查询价格大于等于2000的
models.BookList.objects.filter(price__gte=2000)</p>
<p># 查询价格小于等于2000的
models.BookList.objects.filter(price__lte=2000)</p>
<p># 价格1000-2000之间的
models.BookList.objects.filter(price__range=[1000,2000]) # 两边都包含</p>
<p># 查询主键在指定到条件内
models.BookList.objects.filter(pk__in=[1,2,3])</p>
</dd>
</dl>
<p><a href="#id312"><span class="problematic" id="id313">``</span></a><a href="#id314"><span class="problematic" id="id315">`</span></a></p>
<p>### 图书管理系统表设计</p>
<p>表关系</p>
<ul class="simple">
<li><p>一对一</p></li>
<li><p>一对多</p></li>
<li><p>多对多</p></li>
</ul>
<p>表关系判断：站在两边是否可以同时有多个对方，如果都可以，那么就是一个多对多，如果是单向的一对多，那就是一对多，如果都不是，要么没有任何关系，要么就是一对一</p>
<p>Book</p>
<p>Publish</p>
<p>Author</p>
<p>AuthorDetail</p>
<p>书和出版社就是一个一对多</p>
<p>书和作者就是一个多对多</p>
<p>作者和作者详情就是一个一对一</p>
<p><a href="#id316"><span class="problematic" id="id317">``</span></a><a href="#id318"><span class="problematic" id="id319">`</span></a>python
node(‘codeCheck’) {</p>
<blockquote>
<div><p>stage(‘拉取代码’){</p>
</div></blockquote>
<dl>
<dt>//          git credentialsId: ‘1dc3c20c-b9c5-4294-93c4-9b0cdbd3cd78’, url: <a class="reference external" href="mailto:'git&#37;&#52;&#48;coding&#46;ypsx-internal&#46;com">‘git<span>&#64;</span>coding<span>&#46;</span>ypsx-internal<span>&#46;</span>com</a>:arch-foundation/ostrich/ostrich-api-gateway.git’</dt><dd><blockquote>
<div><blockquote>
<div><p>git credentialsId: ‘1dc3c20c-b9c5-4294-93c4-9b0cdbd3cd78’, url: <a class="reference external" href="mailto:'git&#37;&#52;&#48;coding&#46;ypsx-internal&#46;com">‘git<span>&#64;</span>coding<span>&#46;</span>ypsx-internal<span>&#46;</span>com</a>:business-platform/ypsx-order.git’</p>
</div></blockquote>
<p>updateGitlabCommitStatus name: ‘拉取代码’, state: ‘success’</p>
</div></blockquote>
<p>}
stage(‘质量扫描’) {</p>
<blockquote>
<div><blockquote>
<div><p>withSonarQubeEnv(‘Sonarqube’) {
sh ‘’’</p>
<blockquote>
<div><p>/usr/local/sonar-scanner/bin/sonar-scanner -X </p>
</div></blockquote>
<p>-Dsonar.host.url=${SONAR_HOST_URL} -Dsonar.language=java -Dsonar.projectKey=${JOB_NAME} -Dsonar.projectName=${JOB_NAME} -Dsonar.projectVersion=1.1 -Dsonar.sources=. -Dsonar.sourceEncoding=UTF-8 -Dsonar.java.binaries=.
‘’’</p>
</div></blockquote>
<p>updateGitlabCommitStatus name: ‘代码质量扫描’, state: ‘success’</p>
<blockquote>
<div><p>}</p>
</div></blockquote>
</div></blockquote>
<p>}
stage(‘发送到企业微信’){</p>
<blockquote>
<div><p>sh ‘’’
python3 /home/blsnt/scripts/sonar.py
‘’’
updateGitlabCommitStatus name: ‘发送企业微信’, state: ‘success’</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
<p><a href="#id320"><span class="problematic" id="id321">``</span></a><a href="#id322"><span class="problematic" id="id323">`</span></a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Linux/index.html" class="btn btn-neutral float-right" title="Linux基础" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Python.html" class="btn btn-neutral float-left" title="1. #" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, 小义同学

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>